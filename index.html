<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>換算工具</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background: #f5f5f5;
      padding: 2rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      width: 360px;
      background: white;
      padding: 2rem 2.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }
    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #222;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
      color: #444;
    }
    input[type=number] {
      width: 100%;
      padding: 0.5rem 0.75rem;
      margin-top: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }
    input[type=number]:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 6px #4CAF50aa;
    }
    .buttons {
      margin-top: 1.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    button {
      flex: 0 0 48%;
      padding: 0.5rem 0;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      color: white;
      user-select: none;
      transition: background-color 0.3s;
    }
    button.calc {
      background-color: #4CAF50;
    }
    button.calc:hover {
      background-color: #45a049;
    }
    button.clear {
      background-color: #f44336;
      text-align: center;
    }
    button.clear:hover {
      background-color: #d73727;
    }
    #result {
      margin-top: 1.6rem;
      font-weight: 600;
      color: #333;
      min-height: 2.2em;
      word-break: break-word;
    }
    #result.error {
      color: #d93025;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>備料換算工具</h2>
    <label for="total">數量</label>
    <input type="number" id="total" min="1" placeholder="請輸入總數量" />

    <label for="prep">備料數量</label>
    <input type="number" id="prep" min="0" placeholder="備料數量" />

    <label for="unit">單位</label>
    <input type="number" id="unit" min="1" placeholder="每箱單位" />

    <label for="perPallet">板數</label>
    <input type="number" id="perPallet" min="1" placeholder="每板單位" />

    <div class="buttons">
      <button class="calc" onclick="calculate()">計算</button>
      <button class="clear" onclick="clearFields()">清除</button>
    </div>

    <div id="result"></div>
  </div>

<script>
function calculate() {
  const totalInput = document.getElementById('total');
  const prepInput = document.getElementById('prep');
  const unitInput = document.getElementById('unit');
  const perPalletInput = document.getElementById('perPallet');
  const resultDiv = document.getElementById('result');

  // 取值並轉整數
  const total = parseInt(totalInput.value);
  const prep = prepInput.value === '' ? null : parseInt(prepInput.value);
  const unit = unitInput.value === '' ? null : parseInt(unitInput.value);
  const perPallet = perPalletInput.value === '' ? null : parseInt(perPalletInput.value);

  // 清除錯誤樣式
  resultDiv.classList.remove('error');
  resultDiv.textContent = '';

  // 總數必填檢查
  if (isNaN(total) || total <= 0) {
    resultDiv.classList.add('error');
    resultDiv.textContent = '請輸入有效的數量（總數），且必須大於0';
    return;
  }

  // 備料數檢查（若填）不能大於總數量
  if (prep !== null) {
    if (prep < 0) {
      resultDiv.classList.add('error');
      resultDiv.textContent = '備料數量不可小於0';
      return;
    }
    if (prep > total) {
      resultDiv.classList.add('error');
      resultDiv.textContent = '備料數量不可大於總數量';
      return;
    }
  }

  // 單位（每箱幾支）檢查（若填）
  if (unit !== null) {
    if (unit <= 0) {
      resultDiv.classList.add('error');
      resultDiv.textContent = '單位（每箱幾支）必須大於0';
      return;
    }
    if (unit > total) {
      resultDiv.classList.add('error');
      resultDiv.textContent = '單位（每箱幾支）不可大於總數量';
      return;
    }
  }

  // 每板幾支檢查（若填）
  if (perPallet !== null) {
    if (perPallet <= 0) {
      resultDiv.classList.add('error');
      resultDiv.textContent = '每板幾支必須大於0';
      return;
    }
    if (perPallet > total) {
      resultDiv.classList.add('error');
      resultDiv.textContent = '每板幾支不可大於總數量';
      return;
    }
  }

  // 計算結果字串變數
  let result = '';

  // 有備料數時換算備料與庫存
  if (prep !== null && unit !== null && perPallet !== null) {
    const prepPallets = Math.floor(prep / perPallet);
    const prepRemain1 = prep % perPallet;
    const prepBoxes = Math.floor(prepRemain1 / unit);
    const prepUnits = prepRemain1 % unit;

    const stock = total - prep;
    const stockPallets = Math.floor(stock / perPallet);
    const stockRemain1 = stock % perPallet;
    const stockBoxes = Math.floor(stockRemain1 / unit);
    const stockUnits = stockRemain1 % unit;

    // 備料字串組合，只顯示非0單位
    let prepStr = '';
    if (prepPallets > 0) prepStr += `${prepPallets}板 `;
    if (prepBoxes > 0) prepStr += `${prepBoxes}箱 `;
    if (prepUnits > 0) prepStr += `${prepUnits}支`;
    prepStr = prepStr.trim();
    if (prepStr === '') prepStr = '0支';

    // 庫存字串組合，只顯示非0單位
    let stockStr = '';
    if (stockPallets > 0) stockStr += `${stockPallets}板 `;
    if (stockBoxes > 0) stockStr += `${stockBoxes}箱 `;
    if (stockUnits > 0) stockStr += `${stockUnits}支`;
    stockStr = stockStr.trim();
    if (stockStr === '') stockStr = '0支';

    result = `備料數量：${prepStr}<br>庫存數量：${stockStr}`;
  }
  // 只填總數，且有填單位與板數
  else if (unit !== null && perPallet !== null) {
    const pallets = Math.floor(total / perPallet);
    const remain1 = total % perPallet;
    const boxes = Math.floor(remain1 / unit);
    const units = remain1 % unit;

    let resStr = '';
    if (pallets > 0) resStr += `${pallets}板 `;
    if (boxes > 0) resStr += `${boxes}箱 `;
    if (units > 0) resStr += `${units}支`;
    resStr = resStr.trim();
    if (resStr === '') resStr = '0支';

    result = `庫存數量：${resStr}`;
  }
  // 只填總數，且有填單位（箱）沒填板數
  else if (unit !== null && perPallet === null) {
    const boxes = Math.floor(total / unit);
    const units = total % unit;

    let resStr = '';
    if (boxes > 0) resStr += `${boxes}箱 `;
    if (units > 0) resStr += `${units}支`;
    resStr = resStr.trim();
    if (resStr === '') resStr = '0支';

    result = `庫存數量：${resStr}`;
  }
  // 只填總數，且有填板數沒填箱
  else if (unit === null && perPallet !== null) {
    const pallets = Math.floor(total / perPallet);
    const units = total % perPallet;

    let resStr = '';
    if (pallets > 0) resStr += `${pallets}板 `;
    if (units > 0) resStr += `${units}支`;
    resStr = resStr.trim();
    if (resStr === '') resStr = '0支';

    result = `庫存數量：${resStr}`;
  }
  // 只填總數，沒填箱數和板數，直接顯示支數
  else {
    result = `庫存數量：${total}支`;
  }

  resultDiv.innerHTML = result;
}

function clearFields() {
  document.getElementById('total').value = '';
  document.getElementById('prep').value = '';
  document.getElementById('unit').value = '';
  document.getElementById('perPallet').value = '';
  const resultDiv = document.getElementById('result');
  resultDiv.textContent = '';
  resultDiv.classList.remove('error');
}
</script>
</body>
</html>
